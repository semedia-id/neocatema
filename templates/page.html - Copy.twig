{%- do gantry.debugger.startTimer('render', 'Rendering page') -%}
{%- do gantry.theme.setLayout() -%}
{%- do gantry.theme.loadAtoms() -%}
{%- set segments = gantry.theme.segments() -%}
{%- set boxed = gantry.config.page.body.layout.sections -%}

{%- set page_header = include('component/header-part.html.twig') %}
{%- set page_footer = include('component/footer-part.html.twig') %}

{%- set content %}
    {% if gantry.theme.hasContent() %}
        {% block content %}
        {% endblock %}
    {% endif %}
{% endset -%}

{%- set page_layout %}
    {%- for segment in segments if segment.type != 'offcanvas' -%}
        {% include 'layout/'~segment.type~'.html.twig' with {'segment':segment} %}
    {% endfor %}
{% endset -%}

{%- set page_offcanvas %}
    {%- for segment in segments if segment.type == 'offcanvas' -%}
        {% include 'layout/'~segment.type~'.html.twig' with {'segment':segment} %}
    {% endfor %}
{% endset -%}

{%- set page_offpage %}
    {%- for segment in segments if segment.attributes.offpafe ==1 -%}
        {% include 'layout/'~segment.type~'.html.twig' with {'segment':segment} %}
    {% endfor %}
{% endset -%}


{%- set body_top %}
    {% block body_top %}
    {% endblock %}
    {{ gantry.config.page.body.body_top|raw }}
    {{ gantry.document.getHtml('body_top')|join("\n    ")|raw }}
    {{ page_offcanvas|raw }}
{% endset -%}


{%- set page_top %}
    {% block page_top %}
    {% endblock %}
    {{ gantry.document.getHtml('top')|join("\n    ")|raw }}
{% endset -%}

{%- set page_bottom %}
    {% block page_bottom %}
    {% endblock %}
    
    {{ gantry.document.getHtml('bottom')|join("\n    ")|raw }}

{% endset -%}


{%- set body_bottom %}
    {% block body_bottom %}
    {% endblock %}

    {% if page_offpage|trim %}
        <div id="g-offpage">{{ page_offpage|raw }}</div>
    {% endif %}
	
	{% block page_inlinescript %}
        <script>{{ config.gas.inline_js|sort|join('\n')|stripper(true)|raw }}</script>
    {% endblock %}

    {{ gantry.config.page.body.body_bottom|raw }}
    {{ gantry.document.getHtml('body_bottom')|join("\n    ")|raw }}

{% endset -%}

{% set boxclass = boxed==2 ? "g-container layout-2": "g-container" %}

{%- block page %}

    <!DOCTYPE {{ gantry.config.page.doctype|default('html')|raw }}>
    <html {{ gantry.page.htmlAttributes|raw }}>
    <head>
    {{ page_header|raw }}
    </head>

    <body{{ gantry.page.bodyAttributes({'class': ['page-'~page.slug(), gantry.page.preset, 'g-style-' ~ gantry.theme.preset]})|raw }}>

    {{ body_top|raw }}

    <div id="g-page-surround" class="{{boxclass}}">
		{{ page_top|raw }}
		{{ page_layout|raw }}
		{{ page_bottom|raw }}
    </div>

    {{ page_footer|raw }}

    {{ body_bottom|raw }}
	</body>
    </html>

{% endblock %}